# AWS Bedrock Knowledge Base 存储后端对比测试报告

**测试日期**: 2026-01-31
**测试规模**: Tiny (10文档, 5查询)
**区域**: us-east-1
**嵌入模型**: Amazon Titan Text Embeddings v2 (1024维)

## 执行摘要

本报告对比了AWS Bedrock Knowledge Base在两种存储后端下的实际性能表现：
- **OpenSearch Serverless** (KB ID: KW7EMK7AWL)
- **Aurora PostgreSQL Serverless v2** (KB ID: E5CPZUD2YL)

两个知识库使用相同的S3数据源、相同的嵌入模型，唯一区别是底层向量存储技术。

---

## 测试结果对比

### 性能指标对比表

| 指标 | OpenSearch Serverless | Aurora PostgreSQL | 差异 | 赢家 |
|------|----------------------|------------------|------|------|
| **P50 延迟** | 604.74ms | 587.03ms | -2.9% | ✅ Aurora |
| **P95 延迟** | 1409.03ms | 1639.77ms | +16.4% | ✅ OpenSearch |
| **P99 延迟** | 1507.62ms | 1817.37ms | +20.5% | ✅ OpenSearch |
| **平均延迟** | 834.84ms | 867.50ms | +3.9% | ✅ OpenSearch |
| **最小延迟** | 542.51ms | 562.43ms | +3.7% | ✅ OpenSearch |
| **最大延迟** | 1532.27ms | 1861.77ms | +21.5% | ✅ OpenSearch |
| **标准差** | 464.1ms | 494.3ms | +6.5% | ✅ OpenSearch |
| **QPS** | 1.12 | 1.13 | +0.9% | ≈ 相当 |
| **成功率** | 100% | 100% | 0% | ≈ 相当 |

### 延迟分布可视化

```
OpenSearch Serverless:
  Min ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 542ms
  P50 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 605ms
  P95 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1409ms
  Max ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1532ms

Aurora PostgreSQL:
  Min ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 562ms
  P50 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 587ms
  P95 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1640ms
  Max ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1862ms
```

---

## 详细分析

### 1. P50延迟（中位数性能）

**结果**: Aurora PostgreSQL略胜一筹

- **OpenSearch**: 604.74ms
- **Aurora**: 587.03ms
- **差异**: Aurora快 2.9%

**分析**:
- 在中位数场景下，两者性能基本相当
- Aurora在典型查询场景下表现略好
- 差异不显著（~18ms），对用户体验影响微小

### 2. P95/P99延迟（尾部延迟）

**结果**: OpenSearch Serverless明显更优

- **P95**: OpenSearch 1409ms vs Aurora 1640ms（Aurora慢16%）
- **P99**: OpenSearch 1508ms vs Aurora 1817ms（Aurora慢20%）

**分析**:
- OpenSearch在高百分位查询中更稳定
- Aurora的尾部延迟更高，可能与以下因素有关：
  - 数据库连接池管理
  - Aurora Serverless v2的动态扩缩容特性
  - pgvector HNSW索引在高负载下的性能波动
- 对延迟敏感的应用（如实时聊天），OpenSearch更可靠

### 3. 吞吐量（QPS）

**结果**: 基本相当

- **OpenSearch**: 1.12 QPS
- **Aurora**: 1.13 QPS

**分析**:
- 在tiny规模测试下，两者吞吐能力相当
- 需要进行更大规模测试（small/medium）来评估真实吞吐差异

### 4. 稳定性（标准差）

**结果**: OpenSearch更稳定

- **OpenSearch**: 464.1ms
- **Aurora**: 494.3ms（高6.5%）

**分析**:
- OpenSearch的查询延迟波动更小
- Aurora的变异系数更高，可能受数据库层影响

---

## 成本对比

### OpenSearch Serverless成本

```
组件：
- 2 OCU (indexing) + 2 OCU (search) = 4 OCU 最小配置
- 单价: $0.24/OCU-hour
- 存储: $0.024/GB-month

估算（tiny规模，0.1GB数据）:
- 月成本 = 4 OCU × $0.24 × 730 hours = ~$700/月
- 存储成本 = 0.1GB × $0.024 = $0.002/月
- 总计: ~$700/月
```

### Aurora PostgreSQL Serverless v2成本

```
组件：
- ACU (Aurora Capacity Units): $0.12/ACU-hour
- 存储: $0.10/GB-month
- I/O: $0.20/million requests
- 备份: $0.021/GB-month

估算（tiny规模，0.5 ACU最小配置，0.1GB数据）:
- 计算成本 = 0.5 ACU × $0.12 × 730 hours = ~$44/月
- 存储成本 = 0.1GB × $0.10 = $0.01/月
- I/O成本 = ~0.001 million × $0.20 = ~$0.0002/月
- 总计: ~$44/月
```

**成本优势**: Aurora PostgreSQL 节省约 **93.7%** ($656/月)

⚠️ **注意**: 实际成本会随数据量和查询量增长而变化。对于高流量场景（1000+ QPS），需要重新评估。

---

## 架构差异

### OpenSearch Serverless

```
优势:
✅ 专为搜索优化的架构
✅ HNSW索引针对k-NN查询优化
✅ 自动扩展，无需手动配置
✅ 无VPC配置，部署简单
✅ 尾部延迟更低

劣势:
❌ 成本高（最小4 OCU起步）
❌ 不支持ACID事务
❌ SQL能力有限
❌ 最终一致性
```

### Aurora PostgreSQL + pgvector

```
优势:
✅ 成本低（按实际使用计费）
✅ 完整SQL支持（JOIN、聚合等）
✅ ACID事务保证
✅ 强一致性
✅ 可与现有RDS基础设施集成

劣势:
❌ 需要VPC配置，部署复杂
❌ P95/P99延迟较高
❌ 需要管理数据库连接池
❌ pgvector性能不如专用向量数据库
```

---

## 推荐场景

### 选择 OpenSearch Serverless 的场景

1. **对延迟敏感的应用**
   - 实时聊天机器人
   - 交互式问答系统
   - 需要低尾部延迟保证

2. **纯向量搜索场景**
   - 不需要复杂SQL查询
   - 不需要JOIN或事务
   - 专注于语义检索

3. **快速原型开发**
   - 无需配置VPC
   - 开箱即用
   - 零运维

4. **预算充足的企业**
   - 不在意成本差异
   - 追求最佳性能稳定性

### 选择 Aurora PostgreSQL 的场景

1. **成本敏感型项目**
   - 初创公司/个人项目
   - 低查询量场景（< 100 QPS）
   - 长期运行成本优化

2. **需要复杂查询**
   - 向量搜索 + 结构化过滤
   - 多表关联查询
   - 数据分析需求

3. **已有RDS基础设施**
   - 可复用现有VPC/安全组
   - 统一数据库管理
   - 简化运维

4. **强一致性要求**
   - 金融/电商场景
   - 需要事务保证
   - 关键业务数据

---

## 其他云服务对比

与本次测试中的其他云服务商对比：

| 服务 | P50延迟 | P95延迟 | QPS | 成本估算 |
|------|---------|---------|-----|---------|
| **AWS Bedrock KB (OpenSearch)** | 605ms | 1409ms | 1.12 | $700/月 |
| **AWS Bedrock KB (Aurora PG)** | 587ms | 1640ms | 1.13 | $44/月 |
| 火山引擎 VikingDB | 1260ms | 1722ms | 0.67 | ~¥300/月 |
| 阿里云百炼 | 794ms | 2208ms | 0.82 | ~¥200/月 |

**观察**:
- AWS Bedrock KB（两种后端）在延迟上明显优于国内云服务
- Aurora PG在成本和性能之间取得最佳平衡
- 火山引擎VikingDB延迟最高，但成本适中
- 阿里云百炼P95延迟最高，但成本最低

---

## 结论

### 性能总结

1. **中位数性能**: Aurora PostgreSQL略优（快2.9%）
2. **尾部延迟**: OpenSearch Serverless明显更优（快16-20%）
3. **稳定性**: OpenSearch更稳定（标准差低6.5%）
4. **吞吐量**: 基本相当

### 成本总结

- **Aurora PostgreSQL**: ~$44/月（tiny规模）
- **OpenSearch Serverless**: ~$700/月（tiny规模）
- **成本差异**: Aurora节省93.7%

### 最终推荐

**默认推荐**: **Aurora PostgreSQL Serverless v2**

**理由**:
- 性能差异不显著（中位数延迟实际更好）
- 成本优势巨大（节省93%）
- 提供更多灵活性（SQL、事务、一致性）

**例外情况**: 如果满足以下条件，选择OpenSearch Serverless
- P95/P99延迟对业务至关重要
- 预算充足，不在意成本差异
- 需要最快的部署速度（无VPC配置）
- 纯向量搜索，不需要SQL能力

---

**报告生成**: 2026-01-31
**测试工具**: Cloud Memory Test Framework v1.0
**数据来源**: docs/test-reports/report_20260131_165809.md
